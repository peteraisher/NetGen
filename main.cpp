//  Copyright 2022 Peter Aisher
//
//  main.cpp
//  NetGen
//

#include <iostream>

#include <array>
#include <vector>
#include <string>
#include <utility>
#include <unordered_set>
#include <queue>
#include "vector/vector2.h"
#include "data/cargo_type.h"
#include "data/industry.h"
#include "data/town.h"

#include "Graph.h"
#include "Map.h"


int main(int argc, const char * argv[]) {
  // insert code here...
  Map m = Map();

  std::vector<Point2D> allVertices {};

  std::array<std::vector<Point2D>, CargoTypeCount> industryLocations = {
    std::vector<Point2D>{{1796.f, 872.f}, {1100.f, 1690.f},
      {706.f, 2236.f}, {1984.f, 2014.f}},
    {{2488.f, 211.f}, {270.f, 489.f}, {1293.f, 668.f}, {1705.f, 1150.f},
      {2020.f, 1312.f}, {844.f, 1399.f}, {789.f, 1588.f}, {1050.f, 1546.f},
      {952.f, 1686.f}, {1891.f, 1469.f}, {849.f, 2156.f}, {950.f, 2265.f},
      {713.f, 2473.f}, {1705.f, 2464.f}, {492.f, 722.f}},
    {{1959.f, 2477.f}, {1752.f, 1941.f}, {1241.f, 1681.f},
      {414.f, 2073.f}, {140.f, 2023.f}, {201.f, 2257.f}, {94.f, 1747.f},
      {309.f, 1448.f}, {444.f, 1411.f}, {496.f, 1147.f}, {1478.f, 671.f},
      {1480.f, 484.f}, {1921.f, 649.f}, {2093.f, 497.f}, {205.f, 982.f}},
    {{1696.f, 113.f}, {1540.f, 264.f}, {1141.f, 762.f}, {1629.f, 630.f},
      {1923.f, 802.f}, {1842.f, 1270.f}, {1104.f, 1078.f}, {1145.f, 1285.f},
      {640.f, 1166.f}, {120.f, 1080.f}, {268.f, 2492.f}, {1073.f, 2340.f},
      {1094.f, 2189.f}, {1209.f, 1985.f}, {2176.f, 2344.f}},
    {{773.f, 162.f}, {406.f, 453.f}, {545.f, 617.f}, {700.f, 724.f},
      {2144.f, 658.f}, {2105.f, 875.f}, {2365.f, 1132.f}, {2180.f, 1399.f},
      {2433.f, 1815.f}, {1528.f, 1214.f}, {1325.f, 1572.f}, {1313.f, 1328.f},
      {694.f, 1290.f}, {572.f, 1516.f}, {917.f, 2406.f}, {1444.f, 2326.f}},
    {{582.f, 914.f}, {878.f, 845.f}, {1042.f, 962.f}, {1242.f, 108.f},
      {1356.f, 349.f}, {1744.f, 454.f}, {1954.f, 1085.f}, {2281.f, 513.f},
      {2324.f, 943.f}, {2289.f, 1523.f}, {2146.f, 1151.f}, {2112.f, 1699.f},
      {2090.f, 1523.f}, {795.f, 1750.f}, {551.f, 1711.f}, {429.f, 2256.f}},
    {{411.f, 179.f}, {1653.f, 775.f}, {2200.f, 2118.f}, {853.f, 1921.f}},
    {{1112.f, 2497.f}, {585.f, 2110.f}, {1212.f, 1441.f},
      {2481.f, 1307.f}, {1808.f, 706.f}, {1026.f, 159.f}, {308.f, 349.f}},
    {{1737.f, 263.f}, {1855.f, 995.f}, {288.f, 1262.f}, {1368.f, 2184.f},
      {2382.f, 2197.f}, {100.f, 2398.f}, {1327.f, 1059.f}},
    {{101.f, 595.f}, {681.f, 545.f}, {2273.f, 743.f}, {796.f, 1221.f},
      {517.f, 2398.f}, {1511.f, 1426.f}, {1754.f, 2161.f}, {2308.f, 1657.f}},
    {{2329.f, 1333.f}, {2262.f, 107.f}, {1181.f, 294.f}, {123.f, 1517.f}},
    {{130.f, 150.f}, {685.f, 1947.f}, {2473.f, 670.f}},
    {{936.f, 599.f}, {2477.f, 1613.f}, {1563.f, 2418.f}},
    {{93.f, 278.f}, {1021.f, 386.f}, {1513.f, 1638.f}, {398.f, 1822.f}},
    {{449.f, 1638.f}, {1405.f, 1848.f}, {2388.f, 2472.f}, {1580.f, 965.f}},
    {{164.f, 398.f}, {945.f, 1114.f}, {2080.f, 167.f}, {1412.f, 2463.f}}
  };

  for (size_t i = 0; i < CargoTypeCount; ++i) {
    for (auto & location : industryLocations[i]) {
      m.addIndustry({location, CargoType(i)});
      allVertices.push_back(location);
    }
  }
  std::vector<Town> towns = {
    {{295.f, 191.f}, {CargoType(10), CargoType(15)}, "Femdown"},
    {{916.f, 344.f}, {CargoType(14), CargoType(6)}, "Redruth"},
    {{1948.f, 512.f}, {CargoType(14), CargoType(11)}, "Camelford"},
    {{2411.f, 436.f}, {CargoType(10), CargoType(15)}, "Watlington"},
    {{438.f, 624.f}, {CargoType(13), CargoType(15)}, "Gravesend"},
    {{1455.f, 836.f}, {CargoType(14), CargoType(6)}, "Yeovil"},
    {{2026.f, 960.f}, {CargoType(10), CargoType(6)}, "Bexhill"},
    {{239.f, 1155.f}, {CargoType(14), CargoType(11)}, "Ripon"},
    {{987.f, 1296.f}, {CargoType(14), CargoType(6)}, "Brixham"},
    {{2402.f, 1468.f}, {CargoType(10), CargoType(15)}, "Stanley"},
    {{339.f, 1565.f}, {CargoType(10), CargoType(11)}, "Bedworth"},
    {{1667.f, 1547.f}, {CargoType(13), CargoType(6)}, "Chagford"},
    {{227.f, 1930.f}, {CargoType(13), CargoType(11)}, "Corbridge"},
    {{979.f, 2028.f}, {CargoType(13), CargoType(6)}, "Mirfield"},
    {{1499.f, 2036.f}, {CargoType(13), CargoType(15)}, "Colchester"},
    {{2079.f, 2236.f}, {CargoType(13), CargoType(11)}, "Coulsdon"}
  };

  for (const auto & town : towns) {
    m.addTown(town);
  }

  std::vector<Line2D> impassable_lines = {
    {{1527.f, 2161.f}, {1613.f, 2295.f}, {1748.f, 2333.f}, {1940.f, 2226.f}},
    {{1940.f, 2210.f}, {1893.f, 2130.f}, {1831.f, 2064.f},
      {1853.f, 1907.f}, {1844.f, 1815.f}, {2097.f, 1867.f}},
    {{1254.f, 2077.f}, {1218.f, 2152.f}, {1273.f, 2260.f}, {1274.f, 2374.f}},
    {{2239.f, 2239.f}, {2324.f, 2358.f}},
    {{2030.f, 1951.f}, {2333.f, 2006.f}, {2550.f, 1839.f}},
    {{2401.f, 1731.f}, {2149.f, 1774.f}},
    {{2081.f, 1641.f}, {1840.f, 1793.f}, {1890.f, 1571.f}},
    {{515.f, 1839.f}, {585.f, 1892.f}, {733.f, 1839.f}, {1046.f, 1839.f}},
    {{1318.f, 1652.f}, {1402.f, 1630.f}, {1590.f, 1815.f}, {1704.f, 1774.f}},
    {{1558.f, 1497.f}, {1589.f, 1590.f}, {1715.f, 1731.f}, {1840.f, 1793.f}},
    {{1007.f, 2391.f}, {906.f, 2517.f}},
    {{659.f, 2374.f}, {502.f, 2541.f}, {362.f, 2445.f}},
    {{332.f, 1347.f}, {469.f, 1273.f}, {599.f, 1326.f}, {521.f, 1355.f},
      {643.f, 1404.f}},
    {{220.f, 1528.f}, {232.f, 1681.f}},
    {{362.f, 1008.f}, {411.f, 1054.f}, {675.f, 1018.f}, {597.f, 1073.f},
      {722.f, 1037.f}, {807.f, 1049.f}, {841.f, 1097.f}, {880.f, 1036.f},
      {851.f, 961.f}},
    {{567.f, 710.f}, {584.f, 805.f}},
    {{117.f, 878.f}, {174.f, 831.f}, {261.f, 750.f}, {307.f, 632.f}},
    {{347.f, 263.f}, {492.f, 243.f}},
    {{515.f, 324.f}, {515.f, 504.f}},
    {{567.f, 297.f}, {807.f, 440.f}, {850.f, 647.f}, {969.f, 805.f},
      {1082.f, 845.f}, {1229.f, 815.f}, {1260.f, 739.f}},
    {{851.f, 468.f}, {965.f, 474.f}},
    {{1260.f, 357.f}, {1290.f, 441.f}, {1209.f, 483.f}, {1324.f, 451.f},
      {1356.f, 553.f}, {1354.f, 468.f}, {1383.f, 395.f}},
    {{1427.f, 211.f}, {1558.f, 22.f}},
    {{1683.f, 372.f}, {1779.f, 347.f}, {1887.f, 414.f}},
    {{2056.f, 357.f}, {2030.f, 233.f}, {1963.f, 141.f}},
    {{2149.f, 73.f}, {2216.f, 297.f}},
    {{2492.f, 56.f}, {2367.f, 192.f}},
    {{2564.f, 1123.f}, {2414.f, 908.f}, {2367.f, 814.f}, {2367.f, 698.f},
      {2315.f, 632.f}},
    {{2502.f, 796.f}, {2383.f, 907.f}, {2149.f, 805.f}},
    {{2123.f, 987.f}, {2239.f, 1097.f}},
    {{816.f, 1497.f}, {1086.f, 1422.f}},
    {{198.f, 2482.f}, {232.f, 2297.f}},
    {{1236.f, 1273.f}, {1395.f, 1149.f}},
    {{1427.f, 987.f}, {1383.f, 928.f}},
    {{1683.f, 878.f}, {1780.f, 1034.f}},
    {{1460.f, 592.f}, {1527.f, 570.f}}
  };

  for (const auto& line : impassable_lines) {
    m.addImpassableLine(line);
  }

  m.triangulateAllLocations();
  m.buildNetworkGraph();
  m.setUniformTownCargoRequirement(200.f);
  m.makeAllConnections();
  m.printIndustryInfo();
  m.printTownInfo();
  m.printAllPaths();
  m.printEfficiencyStats();

  return 0;
}
